# Mapping: EANCOM ORDERS to CSV
# Converts EANCOM D96A ORDERS messages to a flat CSV format

name: orders_to_csv
source_type: EANCOM_ORDERS
target_type: CSV

rules:
  # Create a row for each line item using foreach
  - type: foreach
    source: LIN
    target: orders
    rules:
      # Order number from BGM segment
      - type: field
        source: /BGM/e2
        target: order_number
      
      # Line number from LIN segment
      - type: field
        source: e1
        target: line_number
      
      # Product code from LIN segment (composite element value)
      - type: field
        source: e3
        target: product_code
      
      # Quantity from QTY segment - find the QTY that follows this LIN
      - type: field
        source: /QTY/e1
        target: quantity
      
      # Unit price from PRI segment
      - type: field
        source: /PRI/e1
        target: unit_price
